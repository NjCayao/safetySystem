# config/production.yaml - FASE 3: Optimizado para Raspberry Pi
# Configuraci칩n espec칤fica para entorno de producci칩n (Raspberry Pi)

system:
  enable_gui: false              # SIN interfaz gr치fica
  log_level: "INFO"              # Logs moderados para no llenar disco
  debug_mode: false              # Sin debug en producci칩n
  performance_monitoring: true   # CR칈TICO: Monitorear en campo
  auto_optimization: true        # 游 NUEVO: Optimizaci칩n autom치tica habilitada

camera:
  # Configuraci칩n ultra-optimizada para Raspberry Pi
  fps: 4                         # FPS muy bajo para ahorrar CPU
  width: 320                     # Resoluci칩n muy baja para mejor rendimiento  
  height: 240
  
  # Optimizaci칩n agresiva para hardware limitado
  use_threading: true            # Threading para mejor rendimiento
  warmup_time: 3                 # M치s tiempo de calentamiento en Pi
  buffer_size: 1                 # Buffer m칤nimo para latencia baja
  
  # 游 NUEVO: Configuraciones espec칤ficas para Pi
  brightness: 10                 # Ajuste para c치maras de Pi
  contrast: 15                   # Mejorar contraste en condiciones pobres
  exposure: -6                   # Exposure m치s agresivo

fatigue:
  # Configuraci칩n optimizada para recursos limitados
  eye_closed_threshold: 1.8      # M치s permisivo para evitar falsos positivos
  calibration_period: 90         # Calibraci칩n m치s larga para estabilidad en Pi
  frames_to_confirm: 3           # M치s frames para confirmar (m치s estable)
  
  # Configuraci칩n cr칤tica para campo
  enable_night_mode: true        # ESENCIAL para trabajo nocturno
  night_mode_threshold: 35       # M치s sensible para condiciones de campo
  ear_night_adjustment: 0.05     # Ajuste m치s agresivo para modo nocturno

yawn:
  # Configuraci칩n conservadora para producci칩n
  duration_threshold: 3.0        # M치s permisivo para evitar falsos positivos
  max_yawns_before_alert: 3      # Valor conservador
  frames_to_confirm: 4           # M치s frames para estabilidad
  
  # Audio cr칤tico en campo
  enable_sounds: true
  enable_auto_calibration: true
  calibration_frames: 90         # M치s frames para calibraci칩n estable

distraction:
  # Tiempos optimizados para Pi
  level1_time: 4                 # Un poco m치s permisivo
  level2_time: 6                 # Tiempo extendido
  camera_fps: 4                  # Sincronizado con FPS de c치mara
  
  # Configuraci칩n espec칤fica para Pi
  confidence_threshold: 0.8      # M치s alto para evitar falsos positivos
  frames_without_face_limit: 8   # M치s tolerante en Pi
  
  # Audio esencial pero optimizado
  audio_enabled: true
  level1_volume: 0.9             # Volumen alto para ruido de m치quinas
  level2_volume: 1.0

behavior:
  # 游 NUEVO: Configuraci칩n ultra-optimizada para Raspberry Pi
  
  # Configuraci칩n b치sica m치s conservadora
  confidence_threshold: 0.5      # M치s alto para evitar falsos positivos
  night_confidence_threshold: 0.4 # Ajustado para condiciones nocturnas
  
  # 游 OPTIMIZACIONES ESPEC칈FICAS PARA PI
  enable_optimization: true      # Habilitar todas las optimizaciones
  processing_interval: 3         # Procesar solo cada 3 frames para ahorrar CPU
  
  # 游 ROI (Regi칩n de Inter칠s) para reducir 치rea de procesamiento
  roi_enabled: true              # Activar ROI para ahorrar much칤simo CPU
  roi_scale_factor: 0.5          # ROI m치s peque침o = menos procesamiento
  
  # 游 YOLO ultra-optimizado para Pi
  yolo_input_size: 256           # Tama침o muy peque침o para Pi (vs 416 normal)
  nms_threshold: 0.6             # NMS m치s agresivo
  max_detections: 5              # M치ximo 5 detecciones por frame
  
  # 游 Gesti칩n de memoria cr칤tica para Pi
  memory_optimization: true     # Activar limpieza agresiva de memoria
  frame_skip_threshold: 5       # Saltar frames si CPU est치 saturado
  
  # 游 Cache de predicciones para evitar recomputaci칩n
  enable_prediction_cache: true # Cache para frames similares
  cache_size: 3                 # Cache peque침o para Pi
  similarity_threshold: 0.9     # Umbral alto para usar cache
  
  # Configuraci칩n de iluminaci칩n para Pi
  night_mode_threshold: 40      # M치s sensible para Pi sin luz ambiente
  night_image_alpha: 1.2        # Ajuste m치s suave para Pi
  night_image_beta: 30          # Offset menor para Pi
  
  # Tiempos est치ndar pero optimizados
  phone_alert_threshold_1: 4    # Un poco m치s permisivo en Pi
  phone_alert_threshold_2: 8    # Extendido para evitar falsas alarmas
  
  # Configuraci칩n de cigarro optimizada
  cigarette_pattern_window: 25  # Ventana m치s peque침a para ahorrar memoria
  cigarette_pattern_threshold: 2 # Menos detecciones necesarias
  cigarette_continuous_threshold: 8 # Tiempo extendido
  
  # Audio cr칤tico pero controlado
  audio_enabled: true

audio:
  # Configuraci칩n para entorno industrial con Pi
  volume: 1.0                    # Volumen m치ximo para superar ruido
  enabled: true                  # CR칈TICO en producci칩n
  
  # Configuraci칩n optimizada para Pi
  frequency: 22050               # 游 Frecuencia m치s baja para Pi
  channels: 1                    # 游 Mono para ahorrar recursos
  buffer: 4096                   # 游 Buffer m치s grande para estabilidad

# 游 CONFIGURACI칍N DE SINCRONIZACI칍N UNIFICADA (TODO EN UNA SECCI칍N)
sync:
  # Configuraci칩n del servidor y dispositivo
  enabled: true
  server_url: "https://safetysystem.devcayao.com"
  device_id: "RPI50001"
  api_key: "fe02131d43d2cd8099f09ad78ab13bce4f26d2cd2e2a1e7611986775e1636905"
  device_type: "raspberry_pi_5"
  
  # Configuraci칩n ultra-robusta para Pi
  auto_sync_interval: 600        # 10 minutos - balance para Pi lento
  batch_size: 25                 # Lotes m치s peque침os para Pi
  
  # Timeouts m치s largos para Pi y conexiones lentas
  connection_timeout: 20
  read_timeout: 60
  max_retries: 8                 # M치s reintentos para conexiones inestables
  retry_delay: 15
  
  # Endpoints de API
  auth_endpoint: "/auth/authenticate"
  events_endpoint: "/events/create"
  sync_batch_endpoint: "/sync/batch"
  sync_status_endpoint: "/sync/status"
  sync_confirm_endpoint: "/sync/confirm"
  upload_image_endpoint: "/events/upload_image"
  
  # Configuraci칩n de prioridades para eventos
  priority_types: "fatigue,unrecognized_operator"

# 游 CONFIGURACI칍N DE CONEXI칍N
connection:
  check_interval: 30
  retry_attempts: 3
  retry_delay: 5

# 游 CONFIGURACI칍N DE ALMACENAMIENTO
storage:
  db_path: "client/db/local.db"
  max_stored_events: 1000
  max_stored_images: 100
  image_storage_path: "client/images/"

logging:
  # Logging ultra-optimizado para Pi
  level: "WARNING"               # Solo errores importantes para ahorrar disco
  
  # Rotaci칩n agresiva de logs para Pi
  file_max_size: 2097152         # 2MB m치ximo por archivo
  file_backup_count: 2           # Solo 2 archivos de backup
  
  # Logging espec칤fico por m칩dulo (muy reducido)
  modules:
    camera: "ERROR"              # Solo errores cr칤ticos
    fatigue: "WARNING"
    behavior: "WARNING"          # Importante para comportamientos
    sync: "INFO"                 # Mantener info de sync

alerts:
  # Configuraci칩n conservadora para producci칩n en Pi
  cooldown_time: 8               # M치s tiempo entre alertas para Pi

reports:
  # Configuraci칩n optimizada para almacenamiento limitado de Pi
  image_quality: 60              # Calidad muy baja para ahorrar espacio
  auto_cleanup: true             # CR칈TICO: limpiar autom치ticamente
  max_age_days: 15               # Mantener solo 15 d칤as en Pi

# 游 NUEVO: Configuraciones espec칤ficas de optimizaci칩n para Pi
production:
  # 游 Monitoreo cr칤tico del sistema Pi
  enable_system_monitoring: true
  cpu_threshold: 75              # % CPU m치ximo antes de optimizar (m치s estricto)
  memory_threshold: 70           # % memoria m치xima (m치s estricto)
  temperature_threshold: 65      # 춿C m치xima antes de reducir rendimiento (m치s estricto)
  
  # 游 Gesti칩n de energ칤a para Pi
  enable_power_management: true
  reduce_performance_on_low_battery: true
  enable_thermal_throttling: true # Reducir rendimiento si se calienta mucho
  
  # 游 Configuraci칩n de red optimizada para Pi
  connection_types: ["ethernet", "wifi", "cellular"]
  preferred_connection: "ethernet"
  network_timeout: 45            # Timeout m치s largo para Pi
  enable_offline_mode: true      # CR칈TICO: funcionar sin internet
  
  # 游 Recuperaci칩n autom치tica optimizada para Pi
  auto_restart_on_error: true
  max_restart_attempts: 5        # M치s intentos para Pi inestable
  restart_delay: 45              # M치s tiempo entre reintentos
  
  # 游 Heartbeat optimizado para Pi
  heartbeat_interval: 120        # Cada 2 minutos para ahorrar ancho de banda
  heartbeat_timeout: 20
  
  # 游 Configuraci칩n de almacenamiento cr칤tica para Pi
  max_disk_usage: 70             # % m치ximo m치s estricto para microSD
  cleanup_on_disk_full: true
  enable_log_compression: true   # Comprimir logs autom치ticamente
  
  # 游 Configuraci칩n espec칤fica de Raspberry Pi
  raspberry_pi:
    # 游 Optimizaciones de hardware Pi
    enable_hardware_pwm: false   # Desactivar PWM para ahorrar recursos
    gpu_memory_split: 32         # M칤nimo para GPU (m치s RAM para sistema)
    disable_camera_led: true     # Desactivar LED para ahorrar energ칤a
    disable_bluetooth: true      # Desactivar Bluetooth para ahorrar recursos
    disable_wifi_power_save: true # Desactivar ahorro energ칤a WiFi para estabilidad
    
    # 游 Optimizaciones de rendimiento agresivas
    arm_freq: 1400               # Frecuencia ARM reducida para estabilidad
    gpu_freq: 400                # Frecuencia GPU reducida
    over_voltage: 0              # Sin overvolting para estabilidad
    
    # 游 Configuraci칩n de c치mara espec칤fica para Pi
    camera_module: "usb"         # Tipo de c치mara
    camera_auto_exposure: true
    camera_auto_white_balance: true
    
    # 游 Configuraciones de sistema Pi
    enable_watchdog: true        # Watchdog para recuperaci칩n autom치tica
    watchdog_timeout: 30         # Timeout del watchdog
    
    # 游 Gesti칩n t칠rmica espec칤fica
    thermal_throttle_temp: 65    # Temperatura para reducir rendimiento
    thermal_shutdown_temp: 80    # Temperatura de apagado de emergencia